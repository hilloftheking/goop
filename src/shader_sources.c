const char *COMPUTE_SDF_COMP_SRC = "#version 430\nlayout(local_size_x=4,local_size_y=4,local_size_z=4)in;const vec3 _149[8]=vec3[](vec3(0.5),vec3(0.5,0.5,-0.5),vec3(0.5,-0.5,0.5),vec3(0.5,-0.5,-0.5),vec3(-0.5,0.5,0.5),vec3(-0.5,0.5,-0.5),vec3(-0.5,-0.5,0.5),vec3(-0.5));layout(binding=0,std430)restrict readonly buffer BlobOctree{int blob_ot[];}_109;layout(location=0)uniform ivec3 invocation_offset;layout(binding=1,rgba32f)uniform readonly image1D blobs_tex;layout(binding=0,rg32f)uniform writeonly image3D img_output;float dist_cube(vec3 c,float s,vec3 p){vec3 d=abs(p-c)-vec3(s*0.5);return length(max(d,vec3(0.0)));}float dist_sphere(vec3 c,float r,vec3 p){return length(p-c)-r;}float smin(float a,float b,float k){float h=clamp(0.5+((0.5*(b-a))/k),0.0,1.0);return mix(b,a,h)-((k*h)*(1.0-h));}void main(){vec3 p=(((vec3(invocation_offset)+vec3(gl_GlobalInvocationID))+vec3(0.5))*vec3(0.125))+vec3(-8.0,0.0,-8.0);vec3 node_pos=vec3(0.0,8.0,0.0);float node_size=16.0;int node_idx=0;int node_leaf_blob_count=_109.blob_ot[node_idx];while(node_leaf_blob_count==(-1)){bool found_intersection=false;for(int i=0;i<8;i++){vec3 child_pos=node_pos+((vec3(node_size)*_149[i])*0.5);float child_size=node_size*0.5;vec3 param=child_pos;float param_1=child_size;vec3 param_2=p;if(dist_cube(param,param_1,param_2)<=0.0){node_pos=child_pos;node_size=child_size;node_idx=_109.blob_ot[(node_idx+1)+i];node_leaf_blob_count=_109.blob_ot[node_idx];found_intersection=true;break;}}if(!found_intersection){break;}}vec2 values=vec2(1000.0);for(int i_1=0;i_1<node_leaf_blob_count;i_1++){int blob_idx=_109.blob_ot[(node_idx+1)+i_1];vec4 blob=imageLoad(blobs_tex,blob_idx);int is_solid=int(blob.w==(-1.0));vec3 param_3=blob.xyz;float param_4=0.5;vec3 param_5=p;float param_6=values[is_solid];float param_7=dist_sphere(param_3,param_4,param_5);float param_8=0.800000011920928955078125;values[is_solid]=smin(param_6,param_7,param_8);}values=min(vec2(0.5),values);imageStore(img_output,invocation_offset+ivec3(gl_GlobalInvocationID),vec4(values,0.0,0.0));}\n";
const char *RAYMARCH_FRAG_SRC = "#version 430\nlayout(binding=0)uniform sampler3D sdf_tex;layout(location=0)uniform mat4 cam_trans;layout(location=2)uniform float cam_aspect;layout(location=1)uniform float cam_fov;layout(location=0)in vec2 frag_pos;layout(location=0)out vec4 out_color;vec2 intersect_aabb(vec3 ro,vec3 rd,vec3 bmin,vec3 bmax){vec3 tmin=(bmin-ro)/rd;vec3 tmax=(bmax-ro)/rd;vec3 t1=min(tmin,tmax);vec3 t2=max(tmin,tmax);float tnear=max(max(t1.x,t1.y),t1.z);float tfar=min(min(t2.x,t2.y),t2.z);return vec2(tnear,tfar);}vec3 get_normal_at(vec3 p,bool is_solid){vec3 uvw=(p-vec3(-8.0,0.0,-8.0))/vec3(16.0);int i=(!is_solid)? 0 : 1;float gradient_x=texture(sdf_tex,uvw+vec3(0.012500000186264514923095703125,0.0,0.0))[i]-texture(sdf_tex,uvw-vec3(0.012500000186264514923095703125,0.0,0.0))[i];float gradient_y=texture(sdf_tex,uvw+vec3(0.0,0.012500000186264514923095703125,0.0))[i]-texture(sdf_tex,uvw-vec3(0.0,0.012500000186264514923095703125,0.0))[i];float gradient_z=texture(sdf_tex,uvw+vec3(0.0,0.0,0.012500000186264514923095703125))[i]-texture(sdf_tex,uvw-vec3(0.0,0.0,0.012500000186264514923095703125))[i];return normalize(vec3(gradient_x,gradient_y,gradient_z));}vec3 ray_march(vec3 ro,vec3 rd){vec3 param=ro;vec3 param_1=rd;vec3 param_2=vec3(-8.0,0.0,-8.0);vec3 param_3=vec3(8.0,16.0,8.0);vec2 near_far=intersect_aabb(param,param_1,param_2,param_3);bool _167=near_far.x>near_far.y;bool _174;if(!_167){_174=near_far.y<0.0;}else{_174=_167;}if(_174){return vec3(0.0);}float traveled=max(0.0,near_far.x);for(int i=0;i<128;i++){vec3 p=ro+(rd*traveled);vec2 dists=texture(sdf_tex,(p-vec3(-8.0,0.0,-8.0))/vec3(16.0)).xy;float dist=dists.x;bool is_solid=false;if(dists.y<dists.x){dist=dists.y;is_solid=true;}if(dist<=0.001000000047497451305389404296875){vec3 param_4=p;bool param_5=is_solid;vec3 normal=get_normal_at(param_4,param_5);float diffuse_intensity=mix(max(0.0,dot(normal,vec3(-0.3244428336620330810546875,0.811107099056243896484375,-0.4866642653942108154296875))),1.0,0.20000000298023223876953125);if(!is_solid){return vec3(0.4099999964237213134765625,0.039999999105930328369140625,0.0599999986588954925537109375)*diffuse_intensity;}else{return vec3(0.800000011920928955078125,0.800000011920928955078125,0.699999988079071044921875)*diffuse_intensity;}}traveled+=dist;if(traveled>=40.0){break;}if(traveled>=near_far.y){break;}}return vec3(0.300000011920928955078125);}void main(){vec3 ro=vec3(cam_trans[3].xyz);mat4 rot_mat=cam_trans;rot_mat[3]=vec4(0.0,0.0,0.0,1.0);mat4 dir_mat=mat4(vec4(1.0,0.0,0.0,0.0),vec4(0.0,1.0,0.0,0.0),vec4(0.0,0.0,1.0,0.0),vec4(0.0,0.0,0.0,1.0));vec2 ray_offsets=frag_pos;ray_offsets.x*=cam_aspect;dir_mat[3]=vec4(ray_offsets*tan(radians(cam_fov)/2.0),1.0,0.0);vec3 rd=normalize(vec3((rot_mat*dir_mat)[3].xyz));vec3 param=ro;vec3 param_1=rd;out_color=vec4(ray_march(param,param_1),1.0);}\n";
const char *RAYMARCH_VERT_SRC = "#version 430\nlayout(location=0)out vec2 frag_pos;layout(location=0)in vec2 in_pos;void main(){frag_pos=in_pos;gl_Position=vec4(in_pos,0.0,1.0);}\n";
